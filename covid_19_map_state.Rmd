---
title: "HW3 Kariya CSSS569"
author: "Hitomi Kariya, MPH in Health Services"
date: "3/17/2020"
output: html_notebook
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```

```{r}
## Load libraries ##
library(shiny)          # Shiny web app
library(shinydashboard) # ShinyDashboard
library(plotly)         # Interactive plotly map/BI
library(tidyverse)         # Load CSV data sets
```

* I have created a dashboard of two maps for the number of cases and deaths caused by coronavirus in the United States. You can hover over the maps to see the number of cases and deaths reported by states.

* Underlying data: The data is retreived from https://www.nytimes.com/interactive/2020/us/coronavirus-us-cases.html .

* The purpose of this interactive display is to visualize the number of cases and deaths reported by states. The original article in the New York Times visualized a map with locations within states, but here I used the counts by states to simply show the differences across states. I used the "shinydashboard" and  "plotly" packages as well as "shiny" and "tidyverse" packages.

* Goals achived: I was able to create two maps to display each of the number of cases and deaths, but my original goal was to display these two counts on one map by color-scaling the number of cases abd proportionating the number of deaths by states. The next goal for me is to learn how to display these two counts as one map.

```{r}
## Data assigning & object preps ##
# Load a dataset
df <- read_csv("covid19_map_state.csv")

# Create map layers/tool tips
df$hover <- with(df, paste(state_full, '<br>'))

## Plotly_Map this data: l, g, p arguments.##
# Give state light white boundaries with `l` ojbect
l <- list(color = "White", width = 0.5)

# Specify some map options with `g` object
g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  showlakes = TRUE,
  lakecolor = toRGB('white'))

# Create a plotting map object with `p` object for cases
p <- plot_geo(df, locationmode = 'USA-states') %>%
  add_trace(
    z = ~cases, text = ~hover, locations = ~state, marker = list (line=l),
    color = ~cases, colors = 'Blues'
  ) %>%
  colorbar(title = "Number of Cases") %>%
  layout(
    title = 'Confirmed Cases by State<br>(As of July 8, 2020)',
    geo = g
  )

# Create a plotting map object with `p2` object for deaths
p2 <- plot_geo(df, locationmode = 'USA-states') %>%
  add_trace(
    z = ~deaths, text = ~hover, locations = ~state, marker = list (line=l),
    color = ~cases, colors = 'Reds'
  ) %>%
  colorbar(title = "Number of Deaths") %>%
  layout(
    title = 'Confirmed Deaths by State<br>(As of July 8, 2020)',
    geo = g
  )

### For the upcomoing version, I want to figure out a way to click on each state, then details on funding type can be displayed on the right bottom corner as a box.

# Assign the dataset to global environment
assign("df", df, envir=globalenv())
```


```{r}
## ui.R: All about header, sidebar, and body ##
# Create a Header
header <- dashboardHeader(title = "COVID-19 in U.S.")

# Create a Sidebar
sidebar <- dashboardSidebar(
    sidebarMenu(
      menuItem("Map by Cases", tabName = "dashboard", icon = icon("th")),
      menuItem("Map by Deaths", tabName = "widgets", icon = icon("th"))
      ))
  

# Create a Body
body <- dashboardBody(
  tabItems(
    #First tab content
    tabItem(tabName = "dashboard",
      fluidRow(
        box(
          title = "How many COVID-19 cases are reported in the United States?",
          width = 4,
          status = "primary", 'This is a map for the number of cases reported to be caused by coronavirus in the United States. The data is retreived from The New York Times, "U.S. Coronavorus Map: Cases Surpass 5,000". West Viginia remains the only state with no reported coronavirus cases as of 1:21 p.m. PDT, March 17, 2020.'
          ),
        box(
          title = "COVID-19 in the United States", p, width = 8
        )
      )
    ),
    #Second tab content
    tabItem(tabName = "widgets",
      fluidRow(
        box(
          title = "How many COVID-19 deaths are reported in the United States?",
          width = 4,
          status = "primary", 'This is a map for the number deaths reported to be caused by coronavirus in the United States. The data is retreived from The New York Times, "U.S. Coronavorus Map: Cases Surpass 5,000". Washington state has reported the most number of deaths as of 1:21 p.m. PDT, March 17, 2020.'
          ),
        box(
          title = "COVID-19 in the United States", p2, width = 8
        )
      )
        )
    )
)

# Assign everything to UI
ui <- dashboardPage(header, sidebar, body, skin = "purple")

## server.R ##
server <- function(input, output) {}

## Creating the final product ##
shinyApp(ui, server)
```

* Next step 1: Figure out how to display these two maps as one map
* Next step 2: Figure out how to render it as a html file 
* Next step 3: Figure out a way to click on each state and display the numbers on the right bottom corner as a box.

*References
https://plotly-r.com/maps.html
